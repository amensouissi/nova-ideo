<div tal:replace="structure navbar_body"/>
<hr class="soften">
<div class="media-body content-title-body"  i18n:domain="novaideo">
  <div tal:condition="cant_publish" role="alert" class="alert alert-info alert-dismissible">
     <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
     <span class="glyphicon glyphicon-info-sign pull-right"></span>
      <span  i18n:translate="">Pour que votre idée dupliquée puisse être publiée, vous devez préalablement la modifier pour qu'elle ne soit pas identique à l'idée d'origine.</span>
  </div>

  <div tal:condition="cant_submit" role="alert" class="alert alert-info alert-dismissible">
     <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
     <span class="glyphicon glyphicon-info-sign pull-right"></span>
      <span  i18n:translate="">Pour que votre idée dupliquée puisse être soumise, vous devez préalablement la modifier pour qu'elle ne soit pas identique à l'idée d'origine.</span>
  </div>

<h3 tal:condition="state"><span class="label label-basic pull-right" i18n:translate="" tal:content="state"/></h3>
<h3 class="content-title"><span class="icon novaideo-icon icon-idea"></span> ${idea.title}</h3>
  <div class="object-description"
    tal:define="author idea.author;
                original idea.originalentity;
                current_version idea.current_version;
                is_current idea is current_version">
   <small><span i18n:translate="">(Submitted by</span> <a tal:attributes="href request.resource_url(author, '@@index')">${((author is current_user) and 'Vous') or getattr(author, 'title', author.name)}</a> <span i18n:translate="">the</span> <span tal:replace="layout.to_localized_time(idea.created_at)"/> (UTC)<span tal:omit-tag="" tal:condition="original is not None"><span i18n:translate="">, duplicated from the idea</span> <a tal:attributes="href request.resource_url(original, '@@index')">${original.title}</a></span>
   <span tal:omit-tag="" tal:condition="current_version and not is_current"><span i18n:translate="">, previous version of the current version of the idea</span> <a tal:attributes="href request.resource_url(current_version, '@@index')">${current_version.title}</a></span>)
   </small>
  </div>
</div>
<div id="contenttext" class="content-text"  i18n:domain="novaideo">
  <div>${idea.text}</div>
      <div class="keywords-result">
      <span class="glyphicon glyphicon-tags"></span> 
      <tal:loop repeat="k idea.keywords">
            <a tal:attributes="href request.resource_url(request.root, 'search', query={'text_to_search':k})">${k}</a><tal:separator condition="not: repeat['k'].end">, </tal:separator> 
      </tal:loop>
    </div>
</div>

<div tal:condition="files" id="idea_files" class="attached-files" i18n:domain="novaideo">
<small>
 <blockquote class="attached_contents" tal:define="file_len len(files)">
   <dl >
   <dt tal:condition="file_len>1" i18n:translate="">Attachments:</dt>
   <dt tal:condition="file_len==1" i18n:translate="">Attachment:</dt>
   <dd>
        <tal:loop repeat="f files">
          <a tal:attributes="href f['url']">${f['title']}</a><tal:separator condition="not: repeat['f'].end">, </tal:separator> 
        </tal:loop>
   </dd>
 </dl>
 </blockquote>
</small>
</div>
<div tal:replace="structure footer_body"/>

<div tal:condition="'idea' in request.content_to_support and 'published' in idea.state and 'examined' not in idea.state" class="proposal-support pull-right" style="margin-top: -35px">
      <span class="label success" 
        tal:define="
            support any(t.owner is current_user for t in idea.tokens_support);
            action 'withdraw_token_idea' if support else 'support_idea'">
          <span class="${not support and 'hide-bloc' or ''} hidden-xs glyphicon glyphicon-hand-down my-token my-token-success">
          </span>
          <span 
            data-action="${request.resource_url(idea, 'novaideoapi', query={'op': action, 'action': 'support'})}"
            class="token token-toggle token-success glyphicon glyphicon-thumbs-up"></span>
          <span class="support-nb">${len(idea.tokens_support)}</span>
      </span>
      <span class="label danger"
        tal:define="
            oppose any(t.owner is current_user for t in idea.tokens_opposition);
            action 'withdraw_token_idea' if oppose else 'oppose_idea'">
          <span class="${not oppose and 'hide-bloc' or ''} hidden-xs glyphicon glyphicon-hand-down my-token my-token-danger"> 
          </span>
          <span 
            data-action="${request.resource_url(idea, 'novaideoapi', query={'op': action, 'action': 'oppose'})}"
            class="token token-toggle token-danger glyphicon glyphicon-thumbs-down"></span>
          <span class="support-nb">${len(idea.tokens_opposition)}</span>
      </span>
</div>

<div tal:condition="'idea' in request.content_to_examine and  'examined' in idea.state" class="proposal-opinion pull-right"  title="${idea.opinion_value}" style="margin-top: -55px">
  <div class="proposal-explanation hide-bloc">
    <button type="button" class="close" data-dismiss="proposal-explanation"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
     ${idea.opinion['explanation']}</div>
  <div class="circle red ${(idea.opinion['opinion'] != 'unfavorable') and 'off' or 'on' }"></div>
  <div class="circle orange ${(idea.opinion['opinion'] != 'to_study') and 'off' or 'on' }"></div>
  <div class="circle green ${(idea.opinion['opinion'] != 'favorable') and 'off' or 'on'}"></div>
</div>