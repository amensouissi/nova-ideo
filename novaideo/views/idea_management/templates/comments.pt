<ul class="${(origin and 'commentulorigin') or 'commentul hide-bloc'}" i18n:domain="novaideo">
  <tal:loop repeat="item comments">
    <li class="commentli" data-association="${((comment.related_correlation is not None) and 'true') or 'false'}" tal:define="diff view._datetimedelta(item['comment'].created_at); comment item['comment']">
       <div class="thumbnail right-caption span4 comment-data ${(comment.related_correlation is not None) and 'comment-association'}" >
          <img tal:condition="comment.author.picture is not None" tal:attributes="src comment.author.picture.url(request)"  class="img-circle" width="60"/>
          <div class="media-body" style="width:auto;">
           <div  tal:condition="comment.related_correlation is not None" class="association-tag pull-right" i18n:translate=""><span class="glyphicon glyphicon-link"></span> Association</div>
            <small>
              <a tal:attributes="href request.resource_url(comment.author, '@@index')">${getattr(comment.author, 'title', comment.author.name)}</a> - 
              <div  tal:omit-tag="" tal:condition="diff" i18n:translate="">Il y a 
                <span tal:condition="'days' in diff"  i18n:translate="">${diff['days']} jour(s)</span> 
                <span tal:condition="'hours' in diff"  i18n:translate="">${diff['hours']} heur(s)</span> 
                <span tal:condition="'minutes' in diff" i18n:translate="">${diff['minutes']} minute(s)</span>
                <span tal:condition="len(diff.keys()) == 1 and 'seconds' in diff" i18n:translate="">${diff['seconds']} seconde(s)</span>
              </div>
              <span tal:condition="len(diff.keys()) == 0" i18n:translate="">Maintenant</span> - Son intention: 
              <span tal:condition="getattr(comment, 'intention', None)">${comment.intention}</span>
            </small>
            <p>${comment.comment}</p>
            <div tal:condition="comment.related_correlation is not None" id="related_contents">
               <small tal:define="contents comment.related_correlation.targets">
                  <blockquote class="attached_contents">
                    <dl >
                     <dt tal:condition="len(contents)>1" i18n:translate="">Associated contents:</dt>
                    <dt tal:condition="len(contents)==1" i18n:translate="">Associated content:</dt>
                     <dd tal:condition="contents">
                       <tal:loop repeat="f contents">
                           <a tal:attributes="href request.resource_url(f, '@@index')">${f.title}</a>
                           <tal:separator condition="not: repeat['f'].end">, </tal:separator> 
                       </tal:loop>
                     </dd>
                    </dl>
                   </blockquote>
               </small>
            </div>
            <div tal:condition="'commentaction' in item"  id="commentaction" class="pull-right">
                <span tal:condition="comment.comments" 
                      class="comment-replay-nb"
                      onclick="javascript:replays_show(this);">
                  <small i18n:translate=""><span class="glyphicon glyphicon-chevron-down"></span> ${len(comment.comments)} Replay(s)</small>
                </span>
                <div tal:omit-tag="" tal:define="commentaction item['commentaction']">
                 <a id="${commentaction['action_id']}-btn" 
                      class="btn btn-default btn-xs dace-action"
                      style="max-width: 300px;"
                      href="${commentaction['actionurl']}"   
                      data-toggle="modal"
                      data-actionid ="${commentaction['action_id']}" 
                      data-target="#${commentaction['action_id']}"
                      data-updateurl="${commentaction['actionurl_update']}"
                      data-toreplay="${'toreplay' in commentaction}">
                     <span class="glyphicon glyphicon-comment"></span> ${commentaction['action'].title}
                   </a>
                   <script tal:condition="'toreplay' in commentaction">       
                        $(document).ready(function(){
                             $(${'\'#'+commentaction['action_id']+'-btn\''}).click();
                        });
                   </script>  
                   <script>
                        $(document).ready(function(){
                            $(${'\'#'+commentaction['action_id']+'-modal\''}).on('hidden.bs.modal', function (e) {
                               after_execution(${'\"'+commentaction['actionurl_after']+'\"'})
                              })
                        });
                   </script>
                <!-- Modal -->
                   <div class="modal fade" 
                       id="${commentaction['action_id']}-modal" 
                       role="dialog" 
                       aria-labelledby="myModalLabel" 
                       aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                           <div class="modal-header">
                               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                               <h4 class="modal-title" id="myModalLabel"> ${commentaction['action'].title}</h4>
                           </div>
                           <div class="modal-body">
                              ${structure:commentaction['body']}
                           </div>
                         </div>
                      </div>
                   </div>
                </div>
            </div>      
          </div>
       </div>
      <div tal:define="(body, r, m, a) view._rendre_comments(comment.comments)" tal:replace="structure body" />
    </li>
  </tal:loop>
</ul>



